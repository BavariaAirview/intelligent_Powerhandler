<!DOCTYPE html>
<meta charset="utf-8" />
<title>Powerhandler</title>

<script language="javascript" type="text/javascript">

var url = "ws://10.110.0.101:1337/"; // work
//var url = "ws://192.168.100.110:1337/"; // home

Int16Array in_msg;

Boolean bl_sys;
Boolean bl_licht;
Boolean bl_tools;
Boolean bl_PC;
Boolean bl_3dp;
Boolean bl_heiz;


var out_sys;
var out_licht;
var out_tools;
var out_PC;
var out_heiz;
var out_3dp;

var but_sys;
var but_licht;
var but_tools;
var but_PC;
var but_heiz;
var but_3dp;

var canvas_sys;
var canvas_licht;
var canvas_tools;
var canvas_PC;
var canvas_3dp;
var canvas_heiz;

var context_sys;
var context_licht;
var context_tools;
var context_PC;
var context_3dp;
var context_heiz;

// This is called when the page finishes loading
function init() {

    // Assign page elements to variables
    button1 = document.getElementById("ButSystemOFF");
    button2 = document.getElementById("ButLicht");
    button3 = document.getElementById("ButTools");
    button4 = document.getElementById("ButPC");
    button5 = document.getElementById("But3DP");
    button6 = document.getElementById("ButHeizung");

    out_sys = document.getElementById("output_system");
    out_licht = document.getElementById("output_licht");
    out_tools = document.getElementById("output_tools");
    out_PC = document.getElementById("output_PC");
    out_3dp = document.getElementById("output_3DP");
    out_heiz = document.getElementById("output_Heizung");

    canvas_sys = document.getElementById("SystemOn");
    canvas_licht = document.getElementById("Licht");
    canvas_3dp = document.getElementById("3DDrucker");
    canvas_tools = document.getElementById("Tools");
    canvas_PC = document.getElementById("PC");
    canvas_heiz = document.getElementById("Heizung");
    
    // Draw circle in canvas_*
    context_sys = canvas_sys.getContext("2d");
    context_sys.arc(25, 25, 15, 0, Math.PI * 2, false);
    context_sys.lineWidth = 3;
    context_sys.strokeStyle = "black";
    context_sys.stroke();
    context_sys.fillStyle = "black";
    context_sys.fill();
    
    context_licht = canvas_licht.getContext("2d");
    context_licht.arc(25, 75, 15, 0, Math.PI * 2, false);
    context_licht.lineWidth = 3;
    context_licht.strokeStyle = "black";
    context_licht.stroke();
    context_licht.fillStyle = "black";
    context_licht.fill();

    context_tools = context_tools.getContext("2d");
    context_tools.arc(25, 125, 15, 0, Math.PI * 2, false);
    context_tools.lineWidth = 3;
    context_tools.strokeStyle = "black";
    context_tools.stroke();
    context_tools.fillStyle = "black";
    context_tools.fill();

    context_PC = context_PC.getContext("2d");
    context_PC.arc(25, 125, 15, 0, Math.PI * 2, false);
    context_PC.lineWidth = 3;
    context_PC.strokeStyle = "black";
    context_PC.stroke();
    context_PC.fillStyle = "black";
    context_PC.fill();

    context_3dp = context_3dp.getContext("2d");
    context_3dp.arc(25, 175, 15, 0, Math.PI * 2, false);
    context_3dp.lineWidth = 3;
    context_3dp.strokeStyle = "black";
    context_3dp.stroke();
    context_3dp.fillStyle = "black";
    context_3dp.fill();
    
    context_heiz = context_heiz.getContext("2d");
    context_heiz.arc(25, 225, 15, 0, Math.PI * 2, false);
    context_heiz.lineWidth = 3;
    context_heiz.strokeStyle = "black";
    context_heiz.stroke();
    context_heiz.fillStyle = "black";
    context_heiz.fill();


    // Connect to WebSocket server
    wsConnect(url);
}

// Call this to connect to the WebSocket server
function wsConnect(url) {
    
    // Connect to WebSocket server
    websocket = new WebSocket(url);
    
    // Assign callbacks
    websocket.onopen = function(evt) { onOpen(evt) };
    websocket.onclose = function(evt) { onClose(evt) };
    websocket.onmessage = function(evt) { onMessage(evt) };
    websocket.onerror = function(evt) { onError(evt) };
}

// Called when a WebSocket connection is established with the server
function onOpen(evt) {

    // Log connection state
    console.log("Connected");
    
    // Enable button
    button1.disabled = false;
    button2.disabled = false;
    button3.disabled = false;
    button4.disabled = false;
    button5.disabled = false;
    button6.disabled = false;
    
    // Get the current state
    doSend("getState");

}

// Called when the WebSocket connection is closed
function onClose(evt) {

    // Log disconnection state
    console.log("Disconnected");
    
    // Disable button
    button1.disabled = true;
    button2.disabled = true;
    button3.disabled = true;
    button4.disabled = true;
    button5.disabled = true;
    button6.disabled = true;
    
    // Try to reconnect after a few seconds
    setTimeout(function() { wsConnect(url) }, 2000);
}

// Called when a message is received from the server
function onMessage(evt) {

    // Print out our received message
    console.log("Received: " + evt.data);

    // Split Incoming msg
    in_msg = evt.data;
    bl_sys = ################################################################################################
    
    // Update circle graphic with LED state
    switch(bl_sys) {
        case false:
            context_sys.fillStyle = "black";
            context_sys.fill();
            break;
        case true:
            context_sys.fillStyle = "green";
            context_sys.fill();
            break;
        default:
            break;
    }
    switch(bl_licht) {
        case false:
            context_licht.fillStyle = "black";
            context_licht.fill();
            break;
        case true:
            context_licht.fillStyle = "green";
            context_licht.fill();
            break;
        default:
            break;
    }
    switch(bl_tools) {
        case false:
            context_tools.fillStyle = "black";
            context_tools.fill();
            break;
        case true:
            context_tools.fillStyle = "green";
            context_tools.fill();
            break;
        default:
            break;
    }
    switch(bl_PC) {
        case false:
            context_PC.fillStyle = "black";
            context_PC.fill();
            break;
        case true:
            context_PC.fillStyle = "green";
            context_PC.fill();
            break;
        default:
            break;
    }
    switch(bl_3dp) {
        case false:
            context_3dp.fillStyle = "black";
            context_3dp.fill();
            break;
        case true:
            context_3dp.fillStyle = "green";
            context_3dp.fill();
            break;
        default:
            break;
    }
    switch(bl_heiz) {
        case false:
            context_heiz.fillStyle = "black";
            context_heiz.fill();
            break;
        case true:
            context_heiz.fillStyle = "green";
            context_heiz.fill();
            break;
        default:
            break;
    }

  
}

// Called when a WebSocket error occurs
function onError(evt) {
    console.log("ERROR: " + evt.data);
}

// Sends a message to the server (and prints it to the console)
function doSend(message) {
    console.log("Sending: " + message);
    websocket.send(message);
}

// Called whenever the HTML button is pressed
function onPress() {
    doSend(id);
    doSend("getState");
}

// Call the init function as soon as the page loads
window.addEventListener("load", init, false);

</script>

<h2>LED Control</h2>

<table>
    <tr>
        <td><button1 id="SysOFF" onclick="onPress()" disabled>System</button1></td>
        <td><canvas_sys id="SystemOn" width="50" height="50"></canvas_sys></td>
    </tr>
    <tr>
        <td><button2 id="ButLicht" onclick="onPress()" disabled>Licht</button2></td>
        <td><canvas_licht id="Licht" width="50" height="50"></canvas_licht></td>
    </tr>
    <tr>
        <td><button3 id="ButTools" onclick="onPress()" disabled>Tools</button3></td>
        <td><canvas_tools id="3DDrucker" width="50" height="50"></canvas_tools></td>
    </tr>
    <tr>
        <td><button3 id="ButPC" onclick="onPress()" disabled>PC</button3></td>
        <td><canvas_PC id="Tools" width="50" height="50"></canvas_PC></td>
    </tr>
    <tr>
        <td><button4 id="But3DP" onclick="onPress()" disabled>3D_Drucker</button4></td>
        <td><canvas_3dp id="PC" width="50" height="50"></canvas_3dp></td>
    </tr>
    <tr>
        <td><button5 id="ButHeizung" onclick="onPress()" disabled>Heizung</button5></td>
        <td><canvas_heiz id="Heizung" width="50" height="50"></canvas_heiz></td>
    </tr>
</table>